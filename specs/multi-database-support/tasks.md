# 实施计划

- [ ] 1. 扩展配置结构以支持数据库配置

  - 在现有的配置结构体中添加数据库配置字段
  - 定义 DatabaseConfig 结构体包含 Type 和 URL 字段
  - 更新配置加载逻辑以解析数据库配置
  - _需求: 1.1, 2.1_

- [ ] 2. 添加 PostgreSQL 依赖

  - 在 go.mod 中添加 gorm.io/driver/postgres 依赖
  - 更新 go.sum 文件
  - _需求: 1.2, 1.3_

- [ ] 3. 修改 InitDB 函数支持多数据库类型

  - [ ] 3.1 重构 InitDB 函数读取数据库配置

    - 从配置中读取数据库类型和 URL
    - 添加配置验证逻辑
    - 实现默认配置（SQLite）当配置缺失时
    - _需求: 1.1, 1.4_

  - [ ] 3.2 实现数据库驱动选择逻辑

    - 根据配置的数据库类型选择 SQLite 或 PostgreSQL 驱动
    - 使用配置的 URL 初始化 GORM 连接
    - 处理不支持的数据库类型错误
    - _需求: 1.2, 1.3_

  - [ ] 3.3 保持现有初始化逻辑
    - 保留 SQLite 的 WAL 模式设置（仅当使用 SQLite 时）
    - 保持 AutoMigrate 调用不变
    - 保持 admin 用户创建逻辑不变
    - _需求: 3.1, 3.2, 3.3_

- [ ] 4. 添加错误处理和验证

  - 实现数据库连接失败的错误处理
  - 添加 URL 格式验证
  - 提供清晰的错误信息用于配置问题诊断
  - _需求: 4.1, 4.2, 4.3_

- [ ] 5. 更新配置文件示例
  - 在现有 config.toml 中添加数据库配置段
  - 提供 SQLite 和 PostgreSQL 的配置示例
  - 添加配置注释说明 URL 格式
  - _需求: 2.2, 2.3_
