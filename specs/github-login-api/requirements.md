# GitHub 登录 API 需求文档

## 介绍

本文档描述了在 MarkPost 应用中实现 GitHub OAuth2 登录功能的需求。系统将允许用户使用其 GitHub 账户进行身份验证，并在登录成功时生成 JWT 令牌。

## 需求

### 需求 1 - GitHub OAuth2 配置

**用户故事：** 作为系统管理员，我希望配置 GitHub OAuth2 凭据，以便用户可以使用其 GitHub 账户进行身份验证。

#### 验收标准

1. 当应用程序启动时，当配置文件被加载时，系统应当包含 GitHub OAuth2 Client ID 和 Client Secret 设置。
2. 当 GitHub OAuth2 凭据缺失或无效时，当用户尝试进行身份验证时，系统应当返回适当的错误消息。
3. 当 GitHub OAuth2 配置被更新时，当需要应用新配置时，系统应当重启程序以加载新配置。

### 需求 2 - 用户模型扩展

**用户故事：** 作为系统，我希望存储 GitHub 用户 ID，以便用户能够与其 GitHub 账户正确关联。

#### 验收标准

1. 当用户通过 GitHub 进行身份验证时，当接收到 GitHub 用户信息时，系统应当在用户模型中存储 GitHub ID。
2. 当用户已存在于系统中时，当他们再次通过 GitHub 进行身份验证时，系统应当使用现有的用户记录，无需更新任何信息。
3. 当新用户通过 GitHub 进行身份验证时，当接收到其信息时，系统应当创建包含 GitHub ID 的新用户记录。

### 需求 3 - GitHub OAuth2 回调处理器

**用户故事：** 作为用户，我希望完成 GitHub 身份验证，以便我可以使用我的 GitHub 账户访问应用程序。

#### 验收标准

1. 当用户从 GitHub 重定向时，当访问回调 URL `/auth/github/callback` 时，系统应当验证授权码。
2. 当授权码有效时，当调用 GitHub API 时，系统应当将代码交换为访问令牌。
3. 当接收到访问令牌时，当调用 GitHub 用户 API 时，系统应当检索用户的 GitHub ID。
4. 当接收到 GitHub 用户 ID 时，当用户在系统中不存在时，系统应当创建新的用户记录。
5. 当接收到 GitHub 用户 ID 时，当用户已存在于系统中时，系统应当使用现有的用户记录。
6. 当处理用户信息时，当用户成功进行身份验证时，系统应当生成 JWT 访问令牌和刷新令牌。

### 需求 4 - JWT 令牌生成

**用户故事：** 作为用户，我希望在登录成功时接收 JWT 令牌，以便我可以维持我的登录状态。

#### 验收标准

1. 当用户成功通过 GitHub 进行身份验证时，当身份验证完成时，系统应当生成有效期为 24 小时的访问令牌。
2. 当用户成功通过 GitHub 进行身份验证时，当身份验证完成时，系统应当生成有效期为 1 个月的刷新令牌。
3. 当 JWT 令牌生成失败时，当发生错误时，系统应当返回适当的错误消息。

### 需求 5 - 错误处理

**用户故事：** 作为用户，我希望接收清晰的错误消息，以便我能够理解并解决身份验证问题。

#### 验收标准

1. 当 GitHub OAuth2 身份验证失败时，当发生错误时，系统应当返回适当的 HTTP 状态码和错误消息。
2. 当 JWT 令牌生成失败时，当发生错误时，系统应当返回 500 Internal Server Error 响应。
3. 当 GitHub API 不可用时，当系统尝试检索用户信息时，系统应当返回 503 Service Unavailable 响应。
4. 当数据库不可用时，当系统尝试保存用户信息时，系统应当返回 500 Internal Server Error 响应。
